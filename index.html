<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>

    <style>
        :root {
            /* Palette updated to match image */
            --primary-blue: #0052FF;
            /* Vibrant Blue */
            --primary-dark: #0040cc;
            --secondary-bg: #F5F7FA;
            --card-bg: #FFFFFF;

            --success: #00D185;
            /* Green */
            --danger: #FF3B30;
            /* Red */

            --text-main: #1D1D1F;
            --text-secondary: #8E8E93;
            --text-light: #FFFFFF;

            --border-radius-lg: 24px;
            --border-radius-md: 16px;
            --border-radius-sm: 12px;

            --shadow-card: 0 10px 40px rgba(0, 0, 0, 0.05);
            --shadow-float: 0 15px 30px rgba(0, 82, 255, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--secondary-bg);
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: 80px;
            /* Space for bottom nav/actions */
            max-width: 480px;
            /* Force mobile width on desktop for verify */
            margin: 0 auto;
            position: relative;
            background-color: #f0f2f5;
        }

        /* --- Blue Header Section --- */
        .header-section {
            background-color: var(--primary-blue);
            color: var(--text-light);
            padding: 2.5rem 1.5rem 5rem 1.5rem;
            /* Extra padding bottom for overlap */
            border-bottom-left-radius: 32px;
            border-bottom-right-radius: 32px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .header-title {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 1px;
            opacity: 0.8;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .total-balance {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .trend-pill {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.35rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            backdrop-filter: blur(5px);
        }

        /* --- Floating Summary Cards --- */
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            padding: 0 1.5rem;
            margin-top: -3.5rem;
            /* Overlap header */
            position: relative;
            z-index: 2;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 20px;
            box-shadow: var(--shadow-card);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .stat-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .stat-card.income .stat-icon {
            background: rgba(0, 209, 133, 0.1);
            color: var(--success);
        }

        .stat-card.expense .stat-icon {
            background: rgba(255, 59, 48, 0.1);
            color: var(--danger);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-main);
        }

        /* --- Quick Log Section --- */
        .section-container {
            padding: 0 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-panel {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 1.5rem;
            box-shadow: var(--shadow-card);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        /* Type Toggles */
        .type-toggle {
            display: flex;
            background: #F2F4F8;
            padding: 4px;
            border-radius: 12px;
        }

        .toggle-btn {
            background: transparent;
            border: none;
            padding: 0.4rem 1rem;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .toggle-btn.active {
            background: var(--card-bg);
            color: var(--text-main);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .amount-input-group {
            margin-bottom: 1.5rem;
        }

        .amount-input-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }

        .amount-input {
            width: 100%;
            border: none;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-main);
            background: transparent;
            outline: none;
            font-family: 'Inter', sans-serif;
        }

        .amount-input::placeholder {
            color: #E0E0E0;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .custom-select-wrapper,
        .date-input-wrapper {
            background: #F2F4F8;
            border-radius: 16px;
            padding: 0.75rem 1rem;
        }

        .sm-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            font-weight: 600;
            display: block;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
        }

        .custom-input {
            width: 100%;
            background: transparent;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-main);
            outline: none;
            font-family: 'Inter', sans-serif;
        }

        .btn-add {
            width: 100%;
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: transform 0.2s;
            box-shadow: 0 8px 20px rgba(0, 82, 255, 0.25);
        }

        .btn-add:active {
            transform: scale(0.98);
        }

        /* --- Activity Section --- */
        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1.5rem;
            margin-bottom: 1rem;
        }

        .activity-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .view-all-btn {
            color: var(--primary-blue);
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            background: none;
            border: none;
        }

        .transaction-list {
            padding: 0 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .transaction-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
            transition: transform 0.2s;
        }

        .transaction-card:active {
            transform: scale(0.98);
        }

        .t-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .t-icon-box {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            background: #F2F4F8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: var(--primary-blue);
        }

        .t-icon-box.expense {
            color: var(--primary-blue);
            /* Or adjust per category */
        }

        .t-icon-box.income {
            color: var(--success);
            background: rgba(0, 209, 133, 0.1);
        }

        .t-details {
            display: flex;
            flex-direction: column;
        }

        .t-category {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-main);
        }

        .t-date {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .t-amount {
            font-weight: 700;
            font-size: 0.95rem;
        }

        .t-amount.income {
            color: var(--success);
        }

        .t-amount.expense {
            color: var(--danger);
        }

        /* Actions & Modals */
        .action-row {
            padding: 1rem 1.5rem;
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .btn-action {
            white-space: nowrap;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: none;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        /* Modal Styles (kept similar but updated radius) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 100;
            align-items: flex-end;
            /* Bottom sheet style */
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            width: 100%;
            border-top-left-radius: 32px;
            border-top-right-radius: 32px;
            padding: 2rem 1.5rem;
            animation: slideUp 0.3s ease;
            max-height: 85vh;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            width: 90%;
            max-width: 400px;
        }

        .toast {
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: fadeInDown 0.3s;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scrollbar hide */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
    </style>
</head>

<body>

    <!-- Header Section -->
    <div class="header-section">
        <div class="header-title">Total Balance</div>
        <div class="total-balance" id="totalBalance">$0.00</div>
        <div class="trend-pill">
            <span id="monthFilterDisplay">This Month</span>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-container">
        <div class="stat-card income">
            <div class="stat-icon">â†“</div>
            <div class="stat-label">Income</div>
            <div class="stat-value" id="totalIncome">$0.00</div>
        </div>
        <div class="stat-card expense">
            <div class="stat-icon">â†‘</div>
            <div class="stat-label">Expenses</div>
            <div class="stat-value" id="totalExpense">$0.00</div>
        </div>
    </div>

    <!-- Quick Log Section -->
    <div class="section-container">
        <div class="card-panel">
            <div class="panel-header">
                <div class="panel-title">Quick Log</div>
                <div class="type-toggle">
                    <button class="toggle-btn" id="btnTypeExpense"
                        onclick="setTransactionType('expense')">Expense</button>
                    <button class="toggle-btn" id="btnTypeIncome" onclick="setTransactionType('income')">Income</button>
                </div>
            </div>

            <form id="quickLogForm">
                <input type="hidden" id="transactionType" value="expense">

                <div class="amount-input-group">
                    <label class="amount-input-label">AMOUNT</label>
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 2.5rem; font-weight: 700; color: var(--text-main);">Rp</span>
                        <input type="number" id="transactionAmount" class="amount-input" placeholder="0" required>
                    </div>
                </div>

                <div class="input-row">
                    <div class="custom-select-wrapper">
                        <label class="sm-label">CATEGORY</label>
                        <input type="text" id="transactionCategory" class="custom-input" placeholder="e.g. Shopping"
                            list="categorySuggestions">
                        <datalist id="categorySuggestions">
                            <option value="Makan">
                            <option value="Transport">
                            <option value="Belanja">
                            <option value="Hiburan">
                            <option value="Gaji">
                            <option value="Tagihan">
                        </datalist>
                    </div>
                    <div class="date-input-wrapper">
                        <label class="sm-label">DATE</label>
                        <input type="date" id="transactionDate" class="custom-input" required>
                    </div>
                </div>

                <!-- Note Input hidden in simple view, or small -->
                <div class="custom-select-wrapper" style="margin-bottom: 1.5rem;">
                    <label class="sm-label">NOTE (OPTIONAL)</label>
                    <input type="text" id="transactionNote" class="custom-input" placeholder="Add a note...">
                </div>

                <button type="submit" class="btn-add">
                    <span style="font-size: 1.2rem;">+</span> Add Transaction
                </button>
            </form>
        </div>
    </div>

    <!-- Actions Row (Export/Filter) -->
    <div class="action-row">
        <select id="monthSelect" class="btn-action" style="border: 1px solid #ddd;">
            <!-- Populated by JS -->
        </select>
        <select id="yearSelect" class="btn-action" style="border: 1px solid #ddd;">
            <!-- Populated by JS -->
        </select>
        <button class="btn-action" onclick="exportToExcel()">ðŸ“Š Excel</button>
        <button class="btn-action" onclick="exportBackup()">ðŸ’¾ Backup</button>
        <button class="btn-action" style="color: var(--danger);" onclick="confirmReset()">Reset</button>
    </div>

    <!-- Activity Section -->
    <div class="activity-header">
        <div class="activity-title">Activity</div>
        <button class="view-all-btn" onclick="scrollToTop()">Top</button>
    </div>

    <div class="transaction-list" id="transactionListContainer">
        <!-- populated via JS -->
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Edit Modal (kept simplified for functionality) -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem;">Edit Transaction</h2>
            <form id="editForm">
                <div style="margin-bottom: 1rem;">
                    <label class="sm-label">TYPE</label>
                    <select id="editType" class="custom-input"
                        style="background:#f2f4f8; padding: 10px; border-radius:12px;">
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label class="sm-label">AMOUNT</label>
                    <input type="number" id="editAmount" class="custom-input"
                        style="background:#f2f4f8; padding: 10px; border-radius:12px;" required>
                </div>
                <!-- Other fields similar -->
                <div style="margin-bottom: 1rem;">
                    <label class="sm-label">CATEGORY</label>
                    <input type="text" id="editCategory" class="custom-input"
                        style="background:#f2f4f8; padding: 10px; border-radius:12px;" required>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label class="sm-label">DATE</label>
                    <input type="date" id="editDate" class="custom-input"
                        style="background:#f2f4f8; padding: 10px; border-radius:12px;" required>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label class="sm-label">NOTE</label>
                    <input type="text" id="editNote" class="custom-input"
                        style="background:#f2f4f8; padding: 10px; border-radius:12px;">
                </div>

                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="closeEditModal()"
                        style="flex:1; padding: 1rem; border-radius:16px; border:none; background:#eee;">Cancel</button>
                    <button type="submit"
                        style="flex:1; padding: 1rem; border-radius:16px; border:none; background:var(--primary-blue); color:white;">Save</button>
                </div>
                <button type="button" onclick="toggleDeleteConfirm()"
                    style="width:100%; margin-top:10px; padding: 1rem; border-radius:16px; border:none; background:transparent; color:var(--danger);">Delete
                    Transaction</button>
            </form>
        </div>
    </div>

    <!-- Logic Script -->
    <script>
        // State
        let transactions = [];
        let currentEditId = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // Icon Mapping (Simple)
        function getIconForCategory(category) {
            const cat = category.toLowerCase();
            if (cat.includes('makan') || cat.includes('food')) return 'ðŸ”';
            if (cat.includes('transport') || cat.includes('uber') || cat.includes('gojek')) return 'ðŸš—';
            if (cat.includes('belanja') || cat.includes('shopping')) return 'ðŸ›ï¸';
            if (cat.includes('gaji') || cat.includes('salary')) return 'ðŸ’µ';
            if (cat.includes('hiburan') || cat.includes('movie')) return 'ðŸŽ¬';
            if (cat.includes('tagihan') || cat.includes('bill')) return 'ðŸ“„';
            return 'ðŸ’°';
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            initDateParams();
            setTransactionType('expense'); // Default
            setupEvents();
            render();
        });

        function initDateParams() {
            // Month Select
            const monthSelect = document.getElementById('monthSelect');
            ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'].forEach((m, i) => {
                let opt = document.createElement('option');
                opt.value = i;
                opt.textContent = m;
                monthSelect.appendChild(opt);
            });
            monthSelect.value = currentMonth;

            // Year Select
            const yearSelect = document.getElementById('yearSelect');
            for (let y = 2020; y <= 2030; y++) {
                let opt = document.createElement('option');
                opt.value = y;
                opt.textContent = y;
                yearSelect.appendChild(opt);
            }
            yearSelect.value = currentYear;

            // Default Form Date
            document.getElementById('transactionDate').valueAsDate = new Date();
        }

        function setupEvents() {
            document.getElementById('quickLogForm').addEventListener('submit', (e) => {
                e.preventDefault();
                addTransaction();
            });

            document.getElementById('monthSelect').addEventListener('change', (e) => {
                currentMonth = parseInt(e.target.value);
                render();
            });

            document.getElementById('yearSelect').addEventListener('change', (e) => {
                currentYear = parseInt(e.target.value);
                render();
            });

            document.getElementById('editForm').addEventListener('submit', (e) => {
                e.preventDefault();
                saveEdit();
            });
        }

        function setTransactionType(type) {
            document.getElementById('transactionType').value = type;
            // Update Toggle UI
            if (type === 'expense') {
                document.getElementById('btnTypeExpense').classList.add('active');
                document.getElementById('btnTypeIncome').classList.remove('active');
            } else {
                document.getElementById('btnTypeIncome').classList.add('active');
                document.getElementById('btnTypeExpense').classList.remove('active');
            }
        }

        // Data Ops
        function loadData() {
            const data = localStorage.getItem('finance_transactions');
            if (data) transactions = JSON.parse(data);
        }

        function saveData() {
            localStorage.setItem('finance_transactions', JSON.stringify(transactions));
            render();
        }

        function addTransaction() {
            const amt = parseFloat(document.getElementById('transactionAmount').value);
            if (!amt || amt <= 0) return showToast('Invalid amount');

            const newItem = {
                id: crypto.randomUUID(),
                type: document.getElementById('transactionType').value,
                amount: amt,
                category: document.getElementById('transactionCategory').value || 'Uncategorized',
                date: document.getElementById('transactionDate').value,
                note: document.getElementById('transactionNote').value,
                createdAt: new Date().toISOString()
            };

            transactions.push(newItem);
            saveData();

            // Reset Form partly
            document.getElementById('transactionAmount').value = '';
            document.getElementById('transactionNote').value = '';
            showToast('Transaction Added!');
        }

        // Rendering
        function render() {
            const filtered = transactions.filter(t => {
                const d = new Date(t.date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            });

            // Summary
            const income = filtered.filter(t => t.type === 'income').reduce((a, b) => a + b.amount, 0);
            const expense = filtered.filter(t => t.type === 'expense').reduce((a, b) => a + b.amount, 0);

            document.getElementById('totalBalance').textContent = formatMoney(income - expense);
            document.getElementById('totalIncome').textContent = formatMoney(income);
            document.getElementById('totalExpense').textContent = formatMoney(expense);

            // List
            const listContainer = document.getElementById('transactionListContainer');
            listContainer.innerHTML = '';

            const sorted = filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sorted.length === 0) {
                listContainer.innerHTML = '<div style="text-align:center; color:#999; padding:2rem;">No transactions this month</div>';
            } else {
                sorted.forEach(t => {
                    const el = document.createElement('div');
                    el.className = 'transaction-card';
                    el.onclick = () => openEdit(t.id);
                    el.innerHTML = `
                        <div class="t-left">
                            <div class="t-icon-box ${t.type}">
                                ${getIconForCategory(t.category)}
                            </div>
                            <div class="t-details">
                                <span class="t-category">${t.category}</span>
                                <span class="t-date">${formatDate(t.date)} ${t.note ? 'â€¢ ' + t.note : ''}</span>
                            </div>
                        </div>
                        <div class="t-amount ${t.type}">
                            ${t.type === 'income' ? '+' : '-'} ${formatMoney(t.amount)}
                        </div>
                    `;
                    listContainer.appendChild(el);
                });
            }
        }

        // Helpers
        function formatMoney(amount) {
            return 'Rp ' + amount.toLocaleString('id-ID');
        }

        function formatDate(dateStr) {
            const options = { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            // Simple date for now
            const d = new Date(dateStr);
            return d.getDate() + ' ' + ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'][d.getMonth()];
        }

        function showToast(msg) {
            const t = document.createElement('div');
            t.className = 'toast';
            t.innerText = msg;
            document.getElementById('toastContainer').appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }

        // Edit/Delete
        function openEdit(id) {
            currentEditId = id;
            const t = transactions.find(x => x.id === id);
            if (!t) return;

            document.getElementById('editType').value = t.type;
            document.getElementById('editAmount').value = t.amount;
            document.getElementById('editCategory').value = t.category;
            document.getElementById('editDate').value = t.date;
            document.getElementById('editNote').value = t.note || '';

            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            currentEditId = null;
        }

        function saveEdit() {
            if (!currentEditId) return;
            const idx = transactions.findIndex(t => t.id === currentEditId);
            if (idx === -1) return;

            transactions[idx] = {
                ...transactions[idx],
                type: document.getElementById('editType').value,
                amount: parseFloat(document.getElementById('editAmount').value),
                category: document.getElementById('editCategory').value,
                date: document.getElementById('editDate').value,
                note: document.getElementById('editNote').value
            };

            saveData();
            closeEditModal();
            showToast('Saved!');
        }

        function toggleDeleteConfirm() {
            if (confirm('Delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== currentEditId);
                saveData();
                closeEditModal();
                showToast('Deleted');
            }
        }

        function confirmReset() {
            if (confirm('Delete ALL data?')) {
                transactions = [];
                saveData();
            }
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Export (Simplified reuse of previous logic)
        function exportToExcel() {
            showToast('Exporting Excel...');
            // Re-implement if needed, for now placeholder to keep file small
            // Logic exists in previous version, can be copied back if essential
            const filtered = transactions.filter(t => {
                const d = new Date(t.date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            });
            if (filtered.length === 0) return showToast('No data');

            const ws = XLSX.utils.json_to_sheet(filtered);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Data");
            XLSX.writeFile(wb, "FinanceData.xlsx");
        }

        function exportBackup() {
            const dataStr = JSON.stringify(transactions, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-${new Date().toISOString()}.json`;
            a.click();
        }
    </script>
</body>

</html>